server:
  port: 8080

spring:
  application:
    name: gateway-service
  redis:
    host: ${REDIS_HOST:redis}
    port: ${REDIS_PORT:6379}
  cloud:
    gateway:
      routes:
        - id: core-write-route
          uri: lb://core-service
          predicates:
            - Path=/api/core/posts/**, /api/core/interactions/**, /api/core/collections/**
            - Method=POST,PUT,DELETE
          filters:
            - name: RequestRateLimiter
              args:
                redis-rate-limiter.replenishRate: 5
                redis-rate-limiter.burstCapacity: 10
                redis-rate-limiter.requestedTokens: 1
                key-resolver: "#{@userKeyResolver}"
        - id: identity-admin-route
          uri: lb://identity-service
          predicates:
            - Path=/api/identity/admin/**
        - id: identity-route
          uri: lb://identity-service
          predicates:
            - Path=/api/identity/**, /api/notifications/**
        - id: core-route
          uri: lb://core-service
          predicates:
            - Path=/api/core/**
        - id: media-write-route
          uri: lb://media-service
          predicates:
            - Path=/api/media/**
            - Method=POST,DELETE
          filters:
            - name: RequestRateLimiter
              args:
                redis-rate-limiter.replenishRate: 2
                redis-rate-limiter.burstCapacity: 4
                redis-rate-limiter.requestedTokens: 1
                key-resolver: "#{@userKeyResolver}"
        - id: media-route
          uri: lb://media-service
          predicates:
            - Path=/api/media/**
        - id: search-route
          uri: lb://search-service
          predicates:
            - Path=/api/search/**
        - id: moderation-route
          uri: lb://moderation-service
          predicates:
            - Path=/api/moderation/**
        - id: mcp-route
          uri: lb://mcp-service
          predicates:
            - Path=/api/mcp/**
        - id: chat-write-route
          uri: lb://chat-service
          predicates:
            - Path=/api/chat/**
            - Method=POST,DELETE
          filters:
            - name: RequestRateLimiter
              args:
                redis-rate-limiter.replenishRate: 10
                redis-rate-limiter.burstCapacity: 20
                redis-rate-limiter.requestedTokens: 1
                key-resolver: "#{@userKeyResolver}"
        - id: chat-route
          uri: lb://chat-service
          predicates:
            - Path=/api/chat/**
        - id: analytics-route
          uri: lb://analytics-service
          predicates:
            - Path=/api/analytics/**
    loadbalancer:
      ribbon:
        enabled: false # 明确禁用 Ribbon，使用 Spring Cloud LoadBalancer

# JWT 配置建议外置到 Nacos
auth:
  jwt:
    secret: ${JWT_SECRET:sidequest-secret-key-1234567890}
    expiration: 86400000
